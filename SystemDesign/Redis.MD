「面试系列」说说缓存雪崩和缓存穿透的理解，以及如何避免？

缓存雪崩，就是存储在缓存里面的大量数据，在同一个时刻全部过期，

原本缓存组件抗住的大部分流量全部请求到了数据库。

导致数据库压力增加造成数据库服务器崩溃的现象。

「面试系列」说说缓存雪崩和缓存穿透的理解，以及如何避免？
导致缓存雪崩的主要原因，我认为有两个：

缓存中间件宕机，当然可以对缓存中间件做高可用集群来避免。
缓存中大部分key都设置了相同的过期时间，导致同一时刻这些key都过期了。对于这样的情况，可以在失效时间上增加一个1到5分钟的随机值。
缓存穿透问题，表示是短时间内有大量的不存在的key请求到应用里面，而这些不存在的key在缓存里面又找不到，从而全部穿透到了数据库，造成数据库压力。

我认为这个场景的核心问题是针对缓存的一种攻击行为，因为在正常的业务里面，即便是出现了这样的情况，由于缓存的不断预热，影响不会很大。

而攻击行为就需要具备时间是的持续性，而只有key确实在数据库里面也不存在的情况下，才能达到这个目的，所以，我认为有两个方法可以解决：

把无效的key也保存到Redis里面，并且设置一个特殊的值，比如“null”，这样的话下次再来访问，就不会去查数据库了。
但是如果攻击者不断用随机的不存在的key来访问，也还是会存在问题，所以可以用布隆过滤器来实现，在系统启动的时候把目标数据全部缓存到布隆过滤器里面，当攻击者用不存在的key来请求的时候，先到布隆过滤器里面查询，如果不存在，那意味着这个key在数据库里面也不存在。
「面试系列」说说缓存雪崩和缓存穿透的理解，以及如何避免？
布隆过滤器还有一个好处，就是它采用了bitmap来进行数据存储，占用的内存空间很少。

不过，在我看来，您提出来的这个问题，有点过于放大了它带来的影响。

首先，在一个成熟的系统里面，对于比较重要的热点数据，必然会有一个专门缓存系统来维护，同时它的过期时间的维护必然和其他业务的key会有一定的差别。而且非常重要的场景，我们还会设计多级缓存系统。

其次，即便是触发了缓存雪崩，数据库本身的容灾能力也并没有那么脆弱，数据库的主从、双主、读写分离这些策略都能够很好的缓解并发流量。

最后，数据库本身也有最大连接数的限制，超过限制的请求会被拒绝，再结合熔断机制，也能够很好的保护数据库系统，最多就是造成部分用户体验不好。

另外，在程序设计上，为了避免缓存未命中导致大量请求穿透到数据库的问题，还可以在访问数据库这个环节加锁。虽然影响了性能，但是对系统是安全的。

「面试系列」说说缓存雪崩和缓存穿透的理解，以及如何避免？
总而言之，我认为解决的办法很多，具体选择哪种方式，还是看具体的业务场景。

以上就是我对这个问题的理解。



https://www.toutiao.com/article/7091179925058634277/?log_from=95e73def53604_1651409363977